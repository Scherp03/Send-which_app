import{Q as x,a as p}from"./QCard.a5c6b69d.js";import{Q as h}from"./QInput.10305cb2.js";import{r as y,u as k,o as I,c as S,w as r,b as s,Q as w,e as _,h as d}from"./index.d75b9d65.js";import{Q}from"./QPage.44405011.js";import{Q as C,a as q}from"./QLayout.d2ebaba8.js";import{a as V}from"./axios.bf56c3c5.js";import{u as $}from"./use-quasar.0c0ee1e7.js";import"./use-dark.ef90c1ea.js";import"./uid.937d8ee7.js";import"./focus-manager.40072c15.js";import"./private.use-form.189d1252.js";import"./QScrollObserver.b508ddad.js";class m extends Error{}m.prototype.name="InvalidTokenError";function P(i){return decodeURIComponent(atob(i).replace(/(.)/g,(e,o)=>{let t=o.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function T(i){let e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return P(e)}catch{return atob(e)}}function U(i,e){if(typeof i!="string")throw new m("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,t=i.split(".")[o];if(typeof t!="string")throw new m(`Invalid token specified: missing part #${o+1}`);let l;try{l=T(t)}catch(u){throw new m(`Invalid token specified: invalid base64 for part #${o+1} (${u.message})`)}try{return JSON.parse(l)}catch(u){throw new m(`Invalid token specified: invalid json for part #${o+1} (${u.message})`)}}const E=d("div",{class:"text-grey-9 text-h5 text-weight-bold"},"Sign in",-1),L=d("div",{class:"text-grey-8"},"Sign in below to access your account",-1),N=d("div",{class:"text-grey-8"},[_(" Don't have an account yet? "),d("a",{href:"#/register",class:"text-dark text-weight-bold",style:{"text-decoration":"none"}},"Sign up.")],-1),j=d("div",{class:"text-grey-8 q-mb-md"},"or sign in with",-1),B=d("i",{class:"fab fa-google"},null,-1),X={__name:"LoginPage",setup(i){const e=y(""),o=y(""),t=$(),l=k(),u=async()=>{if(!e.value||!o.value){t.notify({type:"negative",message:"Username and password are required."});return}try{const c={username:e.value,password:o.value},a=await(await fetch("https://send-which-app.onrender.com/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json();if(a.success){t.notify({type:"positive",message:a.message}),localStorage.setItem("token",a.token),localStorage.setItem("id",a.id);const g=localStorage.getItem("token"),f=U(g);localStorage.setItem("userType",f.role),localStorage.getItem("userType")==="Admin"?l.push("/admin"):l.push("/auth")}else if(!a.success){t.notify({type:"negative",message:a.message});return}}catch(c){t.notify({type:"negative",message:"An error occurred. Please try again later."}),console.error("Error:",c)}},v=async()=>{const c=await V.post("https://send-which-app.onrender.com/api/v1/requestgoogle");window.open(c.data.url,"_blank","width=500,height=600"),window.addEventListener("message",n=>{if(console.log(n),n.origin!=="https://send-which-app.onrender.com")return;const{success:a,message:g,id:f,token:b}=n.data;a?(setTimeout(()=>{t.notify({progress:!0,type:"positive",message:g})},5e3),localStorage.setItem("token",b),localStorage.setItem("id",f),l.push("/auth")):t.notify({type:"negative",message:g})})};return(c,n)=>(I(),S(C,{view:"lHh Lpr lFf"},{default:r(()=>[s(q,null,{default:r(()=>[s(Q,{class:"flex flex-center"},{default:r(()=>[s(x,{class:"q-pa-md shadow-2 my_card",bordered:""},{default:r(()=>[s(p,{class:"text-center"},{default:r(()=>[E,L]),_:1}),s(p,null,{default:r(()=>[s(h,{dense:"",outlined:"",modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=a=>e.value=a),label:"Username"},null,8,["modelValue"]),s(h,{dense:"",outlined:"",class:"q-mt-md",modelValue:o.value,"onUpdate:modelValue":n[1]||(n[1]=a=>o.value=a),type:"password",label:"Password"},null,8,["modelValue"])]),_:1}),s(p,null,{default:r(()=>[s(w,{style:{"border-radius":"8px"},color:"dark",rounded:"",size:"md",label:"Sign in","no-caps":"",class:"full-width",onClick:u})]),_:1}),s(p,{class:"text-center q-pt-none"},{default:r(()=>[N]),_:1}),s(p,{class:"text-center q-pt-none"},{default:r(()=>[j,s(w,{class:"social-btn q-mb-sm",color:"white","text-color":"black",rounded:"",size:"md","no-caps":"",onClick:v},{default:r(()=>[B,_(" Google ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{X as default};
